<!DOCTYPE html>
<html>
<head>
  <title>Milk Cost Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    .box {
      background: white;
      padding: 15px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
    }
    .history {
      margin-top: 20px;
    }
    .record {
      background: #e9f5ff;
      padding: 10px;
      margin: 10px 0;
      border-left: 4px solid #007bff;
      border-radius: 5px;
    }
    .highlight {
      font-weight: bold;
      color: green;
    }
    .delete-btn {
      margin-top: 5px;
      background: red;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>Milk Cost Calculator</h2>
    <label>Month</label>
    <input type="month" id="month" />

    <label>Cost per liter</label>
    <input type="number" id="rate" placeholder="e.g., 75" />

    <label>Fixed cups per day</label>
    <input type="number" id="cups" placeholder="e.g., 6" />

    <label>Fixed number of days</label>
    <input type="number" id="days" placeholder="e.g., 30" />

    <h4>Additional variable entries (optional)</h4>
    <div id="variableSection"></div>
    <button onclick="addVariable()">+ Add Variable Entry</button>

    <button onclick="calculate()">Calculate & Save</button>

    <div class="history">
      <h3>History</h3>
      <div id="historyList"></div>
    </div>
  </div>

  <script>
    function addVariable() {
      const div = document.createElement("div");
      div.innerHTML = `
        <input type="number" placeholder="Variable Cups" class="varCup" />
        <input type="number" placeholder="Days" class="varDay" />
      `;
      document.getElementById("variableSection").appendChild(div);
    }

    function getMonthName(monthStr) {
      const [year, month] = monthStr.split("-");
      const date = new Date(year, month - 1);
      return date.toLocaleString("default", { month: "long", year: "numeric" });
    }

    function calculate() {
      const month = document.getElementById("month").value;
      const rate = parseFloat(document.getElementById("rate").value);
      const fixedCups = parseInt(document.getElementById("cups").value) || 0;
      const fixedDays = parseInt(document.getElementById("days").value) || 0;

      const varCups = document.querySelectorAll(".varCup");
      const varDays = document.querySelectorAll(".varDay");

      let breakdown = [];
      let totalCups = fixedCups * fixedDays;
      if (fixedCups && fixedDays) {
        breakdown.push(`${fixedCups} cups × ${fixedDays} days = ${fixedCups * fixedDays} cups`);
      }

      for (let i = 0; i < varCups.length; i++) {
        const cups = parseInt(varCups[i].value) || 0;
        const days = parseInt(varDays[i].value) || 0;
        if (cups && days) {
          const subTotal = cups * days;
          totalCups += subTotal;
          breakdown.push(`${cups} cups × ${days} days = ${subTotal} cups`);
        }
      }

      const liters = totalCups / 8;
      const total = liters * rate;

      const record = {
        month,
        name: getMonthName(month),
        rate,
        totalCups,
        liters: liters.toFixed(2),
        total: total.toFixed(2),
        breakdown
      };

      let records = JSON.parse(localStorage.getItem("milkRecords") || "[]");
      records = [record, ...records.filter(r => r.month !== month)];
      localStorage.setItem("milkRecords", JSON.stringify(records));

      showHistory();
    }

    function showHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      const records = JSON.parse(localStorage.getItem("milkRecords") || "[]");

      for (let record of records) {
        const div = document.createElement("div");
        div.className = "record";
        div.innerHTML = `
          <strong>${record.name}</strong><br>
          ${record.breakdown.join("<br>")}<br><br>
          <span class="highlight">Total Cost: Rs ${record.total}</span><br>
          <button class="delete-btn" onclick="deleteRecord('${record.month}')">Delete</button>
        `;
        list.appendChild(div);
      }
    }

    function deleteRecord(month) {
      let records = JSON.parse(localStorage.getItem("milkRecords") || "[]");
      records = records.filter(r => r.month !== month);
      localStorage.setItem("milkRecords", JSON.stringify(records));
      showHistory();
    }

    window.onload = showHistory;
  </script>
</body>
</html>
